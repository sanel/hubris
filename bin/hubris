#!/bin/sh

VERSION="0.1.0"

# content location
program=`basename $0`
hubris_dir="`dirname $0`"
hubris_dir=`echo $hubris_dir | sed 's/\/bin//'`
hubris_jar="$hubris_dir/hubris-$VERSION-standalone.jar"

# rlwrap stuff
RLWRAP=`which rlwrap`
breakchars="(){}[],^%$#@\"\";:''|\\"

help() {
   cat <<EOF
Usage: $program [OPTIONS]
$program is a Hbase UBeR Interactive Shell
Options:
   --help       this help
   --version    show version
   --clojure    go directly in clojure mode
   --debug      display various details from hbase logger and $program
EOF
}

if test $# -ne 0; then
   case $1 in
      "--help")
      help
      exit 0
      ;;
      "--version")
      echo $VERSION
      exit 0
      ;;
      "--clojure")
      clojure_mode="true"
      ;;
      "--debug")
      export HUBRIS_DEBUG=1
      ;;
      *)
      echo "Unknown option. Run '$program --help' for all options."
      exit 1
   esac
fi

# find and resolve dependencies first
CLASSES="$hubris_dir/lib"
export CLASSPATH="$CLASSPATH:`find $CLASSES -name "*.jar" | tr '\n' ':'`"

if test ! -f $hubris_jar; then
   echo "Unable to find application jar file. Did you compiled $program???"
   exit 1
fi

if test "x$RLWRAP" != "x"; then
   [ "x$HUBRIS_DEBUG" = "x1" ] && echo "Using rlwrap..."
   COMMAND="$RLWRAP --remember -c -b $breakchars -f $hubris_dir/utils/completions"
else
   [ "x$HUBRIS_DEBUG" = "x1" ] && echo "NOT using rlwrap..."
   COMMAND=""
fi

$COMMAND java -jar $hubris_jar $clojure_mode
